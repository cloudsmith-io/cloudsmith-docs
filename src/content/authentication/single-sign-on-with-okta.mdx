import { Note, BlockImage } from '@/components'
import imgc6fa9a9_okta_create_app_integration from './images/single-sign-on-with-okta/c6fa9a9-okta-create-app-integration.png'
import img6476b61_okta_create_app_integration_modal from './images/single-sign-on-with-okta/6476b61-okta-create-app-integration-modal.png'
import img48b6395_okta_create_app_integration_step1 from './images/single-sign-on-with-okta/48b6395-okta-create-app-integration-step1.png'
import img4e5b80b_okta_create_app_integration_step2 from './images/single-sign-on-with-okta/4e5b80b-okta-create-app-integration-step2.png'
import img3d740f0_okta_create_app_integration_sttribute_statements from './images/single-sign-on-with-okta/3d740f0-okta-create-app-integration-sttribute-statements.png'
import imge16e76b_okta_create_app_integration_step3 from './images/single-sign-on-with-okta/e16e76b-okta-create-app-integration-step3.png'
import imgd48b24a_okta_assign_people from './images/single-sign-on-with-okta/d48b24a-okta-assign-people.png'
import img636281f_okta_saml_metadata from './images/single-sign-on-with-okta/636281f-okta-saml-metadata.png'
import imgaa6b34a_image from './images/single-sign-on-with-okta/aa6b34a-image.png'
import imgd1568be_image from './images/single-sign-on-with-okta/d1568be-image.png'
import img1430b35_image from './images/single-sign-on-with-okta/1430b35-image.png'
import img04b7376_image from './images/single-sign-on-with-okta/04b7376-image.png'
import img_sso_with_okta_screenshot4 from './images/single-sign-on-with-okta/f644e56a69fe3fea8d0371a39d146a7ce36412a4fc498f1dfd88f5633b7bb368-sso-with-okta-screenshot4.png'
import img_sso_okta_scim_edited from './images/single-sign-on-with-okta/03aa91ea5a1b2107d0582299e5bbc1e9904eea098733f1dbec45afd5ab65009b-sso-okta-scim-edited.png'
import imgae20261_Screenshot_2022_11_15_at_10_00_08 from './images/single-sign-on-with-okta/ae20261-Screenshot_2022-11-15_at_10.00.08.png'
import imga4625db_Provisioning from './images/single-sign-on-with-okta/a4625db-Provisioning.png'
import img93fc9ed_To_app from './images/single-sign-on-with-okta/93fc9ed-To_app.png'

# Single Sign-On with Okta

This guide provides step-by-step instructions on setting up Okta as a SAML IdP for your Cloudsmith Organization.

## Adding Cloudsmith to Okta

Cloudsmith is not yet an integrated application in [Okta](https://www.okta.com/). You'll have to add Cloudsmith manually so you can configure SSO.

### Step 1
Log into Okta and click "Applications" and then "Create App Integration"

<BlockImage src={imgc6fa9a9_okta_create_app_integration} alt=""></BlockImage>

You will then see a modal window pop up where you define the application details

### Step 2
Select SAML 2.0 and click next:

<BlockImage src={img6476b61_okta_create_app_integration_modal} alt=""></BlockImage>

### Step 3
On the next screen (General Settings), enter the App name as "Cloudsmith". (You can optionally add the Cloudsmith logo too for easier visibility, you can find hi-res versions of the logo [here](https://cloudsmith.com/company/brand)):

<BlockImage src={img48b6395_okta_create_app_integration_step1} alt=""></BlockImage>

### Step 4
Next, we'll configure SAML settings. To determine your **Single sign on URL** use the following format:

```
https://app.cloudsmith.com/WORKSPACE/saml/acs/
```

Where `WORKSPACE` is your Cloudsmith organization identifier (slug).

We use the same URL for the **Audience URI** value.

For **Name ID Format** choose "EmailAddress"
For **Application username** choose "Email".

<BlockImage src={img4e5b80b_okta_create_app_integration_step2} alt=""></BlockImage>

### Step 5
Next, we'll configure Okta to also send the user's first and last names during sign-in:

<BlockImage src={img3d740f0_okta_create_app_integration_sttribute_statements} alt=""></BlockImage>

Then click the blue **Next** button at the bottom of the page.

### Step 6
Fill out the **Feedback** section on the next page and click the blue **Finish** button:

<BlockImage src={imge16e76b_okta_create_app_integration_step3} alt=""></BlockImage>

### Step 7
Your application is now configured on Okta and you can add users and groups as required using the **Assignments** tab of your application management screen:

<BlockImage src={imgd48b24a_okta_assign_people} alt=""></BlockImage>

## Providing configuration to Cloudsmith

Once configured as above, you'll need to provide metadata to Cloudsmith to connect to your newly configured IdP.

In the **Sign On** tab of your application management screen, you can see a link to view the IdP metadata (under SAML Signing Certificates):

<BlockImage src={img636281f_okta_saml_metadata} alt=""></BlockImage>


Copy this metadata and add it to your Cloudsmith organization [SAML settings](/authentication/single-sign-on) as Inline XML.

You can then [enable SAML authentication](/authentication/single-sign-on#enable-saml) in your Cloudsmith organization, and you can use Okta to begin logging in straight away.

You'll be able to access the landing page of your organization at the following URL:

```
https://app.cloudsmith.com/WORKSPACE/saml/login/
```

Where `WORKSPACE` is your organization's slug/identifier (what you would normally see in the URL when accessing your organization within Cloudsmith). If you're unsure what this is, please just [contact us](https://cloudsmith.com/company/contact-us)!

You can also optionally set up [SAML Group Sync mappings](/authentication/single-sign-on) to automatically map OKTA groups to teams in your Cloudsmith organization, and SCIM to provision, deprovision and update user profile information.

## SAML Group Sync

Once SAML has been setup, group sync can then be configured in order to automatically assign teams from your OKTA directory to Cloudsmith.

In order to get started, go to your Cloudsmith application in OKTA and click on the **General** tab:

<BlockImage src={imgaa6b34a_image} alt=""></BlockImage>

Under **SAML Settings** click **Edit**:

<BlockImage src={imgd1568be_image} alt=""></BlockImage>

Click **Next** to proceed to step 2 and under **A** section on the very bottom **(Group Attribute Statements)** insert the name of the group from Okta along with the valid filter, for example, a group called "Dev" in OKTA will look like this:

<BlockImage src={img1430b35_image} alt=""></BlockImage>

The attribute for the group:

<BlockImage src={img04b7376_image} alt=""></BlockImage>

Once all desired groups are inserted in Okta, you can now configure the group mapping in Cloudsmith. In your Cloudsmith workspace, go to "Settings" -> "Authentication" -> "SAML Group Sync", click "Enable SAML Group Sync" then "Create Group Sync Mapping".

The name and value will be the same as the group attribute created in OKTA:

<BlockImage src={img_sso_with_okta_screenshot4} alt=""></BlockImage>

<Note variant="note">
  To test SAML Group Sync, the user must re-log for the sync to apply.
</Note>

## SCIM

SCIM, or System for Cross-domain Identity Management, is an open standard designed to manage user identity information. Cloudsmith is SCIM 2.0-compliant. With Cloudsmith's support for SCIM, you can automatically provision new users, de-provision existing users and update existing users profile information based on changes within your idP.

To get started using SCIM, go to "Settings" -> "Authentication" -> "SCIM" and "Allow SCIM":

<BlockImage src={img_sso_okta_scim_edited} alt=""></BlockImage>

Once SCIM functionality is allowed in Cloudsmith, you then enable SCIM for the Cloudsmith application in Okta on the "General" tab:

<BlockImage src={imgae20261_Screenshot_2022_11_15_at_10_00_08} alt=""></BlockImage>

You then use the "Provisioning" tab to configure SCIM as follows:

<BlockImage src={imga4625db_Provisioning} alt=""></BlockImage>

|||
|:---|:---|
|SCIM Connector base URL|https://api.cloudsmith.io/scim/v2|
|Unique Identifier for users|email|
|Supported provisioning actions|Push New Users
Push Profile Updates|
|Authentication Mode|Basic Auth|
|Basic Auth Username|token|
|Basic Auth Password|In your Cloudsmith workspace, go to "Settings" -> "Authentication" -> "SCIM" to retrieve your password token.|

Then test and save the configuration.

Once saved, you can then enable the "Create Users", "Update User Attributes" and "Deactivate Users" functionality via the "Provisioning" > "To App" tab:

<BlockImage src={img93fc9ed_To_app} alt=""></BlockImage>

Okta is now configured to provision, update and de-provision users from your Cloudsmith organization.
