import { Note, BlockImage } from '@/components'
import img5eb0f037d17a90f5bcce678b6eb8a06e3f78eaffcd89d078fab466fead2b7313_Screenshot_2024_10_18_at_22_48_05 from './images/retention-lifecycle/5eb0f037d17a90f5bcce678b6eb8a06e3f78eaffcd89d078fab466fead2b7313-Screenshot_2024-10-18_at_22.48.05.png'
import img6653be612eee27401b05591796f082da4afa79901b807c2089df8fd570e5b391_Screenshot_2024_10_18_at_22_48_05 from './images/retention-lifecycle/6653be612eee27401b05591796f082da4afa79901b807c2089df8fd570e5b391-Screenshot_2024-10-18_at_22.48.05.png'

# Retention Lifecycle

---
## Enabling and Configuring Retention / Lifecycle policies

Automated retention/lifetime rules (available on the Velocity plan and above) allow you to automatically manage storage for packages by deleting or moving packages that fall outside of the defined retention rules. Assets can be expired based on the number of packages (count), the size of packages (bytes), or the number of days (time).

To enable and configure retention/lifecycle rules, click "Artifact Lifecycle" in the lefthand menu on a repository detail page, then use the sliders to set your policy, and finally click the green "Enable Lifecycle" button. 

<BlockImage src={img5eb0f037d17a90f5bcce678b6eb8a06e3f78eaffcd89d078fab466fead2b7313_Screenshot_2024_10_18_at_22_48_05} alt="Enabling Retention / Lifecycle policy"></BlockImage>

The retention rules are disjunctive, so it uses all three to select what to delete.  Packages are deleted based on the date pushed, starting with the oldest. 

If grouping is selected, it applies to the rules to each "grouping". Otherwise, it's across all packages within a repository.

If ‚ÄúGroup Packages by Name‚Äù is selected, retention will apply to groups of packages by name rather than all packages. For example, when retaining by a count limit of 1 and you upload PkgA 1.0, PkgB 1.0 and PkgB 1.1; only PkgB 1.0 is deleted because there are two (2) PkgBs and one (1) PkgA

If ‚ÄúGroup Packages by Format‚Äù is selected, retention will apply to packages within package types rather than across all package formats. For example, when retaining by a limit of 1 and you upload PythonPkg 1.0 and RubyPkg 1.0, no packages are deleted because they are different formats

**Example - Retention Policy that deletes packages older than 100 days** 

To configure a retention / lifecycle policy that removes packages older than 100 days, you would set the following: 

- "Limit By Days" = 100
- "Limit By Count" = 1000 
- "Limit By Size" = 0.0B (disabled)

By disabling count and size, it means it only uses the package age to delete

<BlockImage src={img6653be612eee27401b05591796f082da4afa79901b807c2089df8fd570e5b391_Screenshot_2024_10_18_at_22_48_05} alt="100 day Retention Policy"></BlockImage>

<Note variant="note">
Retention rules only activate when packages are uploaded (synchronized). So you could have one package at 1000 days, and the 90 days retention still wouldn't activate. Only after uploading a new package would the 1000 day package be deleted.
</Note>

#### How Resync Affects Retention Rules

Retention rules can also be triggered by resyncing the **most recently uploaded package** in your repository.

Cloudsmith determines which packages to delete by using a cutoff date.  
The cutoff date is calculated by subtracting the retention days from the uploaded date of the resynced package.

For example:  
If your newest package was uploaded on June 10th and the retention period is 4 days, the cutoff date is June 6th. Any packages uploaded before June 6th are eligible for deletion.

<Note>üìò Resyncing a package will trigger the retention rules to run again, but it does **not** update the uploaded date of any package.</Note>