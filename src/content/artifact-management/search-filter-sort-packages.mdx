import { Note, BlockImage } from '@/components'
import img_package_search_6_edited from './images/search-filter-sort-packages/97075343a9a33ef4bbc6957a18556c5b6cdd8e7b22ef88370bdd70f23d3e2902-package-search-6-edited.png'
import img_package_search_3_edited from './images/search-filter-sort-packages/58be45141bb3dd355135c9535b94b4433d28a8a7b064b0d619157a717592a59b-package-search-3-edited.png'
import img1aa0913_search_pkgs_cli_format from './images/search-filter-sort-packages/1aa0913-search_pkgs_cli_format.png'
import imga2f0d45_search_pkgs_cli_tag_and from './images/search-filter-sort-packages/a2f0d45-search_pkgs_cli_tag_and.png'
import imgac51e3f_search_pkgs_cli_size_dls from './images/search-filter-sort-packages/ac51e3f-search_pkgs_cli_size_dls.png'

# Searching Packages

Searching for packages is simple and powerful with Cloudsmith. The search syntax is fully "boolean", in that you can combine queries together with `AND` (i.e. find this AND that), or `OR` (i.e. find this OR that), or `NOT` (i.e. find NOT this). This is optional, if you don't put any boolean operators (AND/OR) in, we'll just assume that you want `AND` by default.

## Search Terms

|Search By|Search Terms Example|
|:---|:---|
|Name (`name`)|`name:my-package` (package name contains "my-package"; use anchors for exact match)|
|Filename (`filename`)|`filename:my-package.ext` (filename contains "my-package.ext"; use anchors for exact match)|
|Tag (`tag`)|`tag:latest` (a package tag contains "latest"; use anchors for exact match)|
|Version - String-based (`version`)|`version:^1.1.0$` (package version is exactly 1.1.0)<br />`version:1.1.0*post1` (package version contains 1.10 followed by post1).|
|Version - Semantic (`version`)|`version:1.1.0` (package version is "1.1.0")<br />`version:>1.1.0` (package version is greater than "1.1.0")<br />`version:<1.1.0` (package version is less than "1.1.0")<br />`version:~=1.1.0` (package version is greater or equal to 1.1.0, but less than 1.2.0)|
|Prerelease (`prerelease`)|`true` (packages are prerelease) `false` (packages are not prerelease)|
|Architecture (`architecture`)|`architecture:x86_64` (architecture is "x86_64")|
|Distribution (`distribution`)|`distribution:el/7` (distribution is "el", release is "7")|
|Format (`format`)|`format:deb` (format is "deb" [debian])|
|Status (`status`)|`status:in_progress` (status is "in_progress")|
|File Checksum (`checksum`)|`checksum:5afba` (checksum contains "5afba")|
|Downloads (`downloads`)|`downloads:>8` (more than 8 downloads)<br />`downloads:<1000` (at least 1, but less than 1000 downloads)|
|Package Type (`type`)|`type:binary` (Binary Packages)<br />`type:source` (Source Packages)<br />`type:combined` (Binary and Source Packages)|
|Size in Bytes (`size`)|`size:>50000` (size is greater than 50000)<br />`size:<10000` (size is less than 10000)|
|Uploaded Date (`uploaded`)|`uploaded:’1 day ago’` (uploaded more than one day ago) `uploaded:’August 14, 2019 EST’` (uploaded on Aug 14th)|
|Entitlement Token Identifier (`token`)|`token:3lKPVJPosCsY` (packages visible for specified token)|
|Dependencies (`dependency`)|`dependency:log4j` (search for packages that have a dependency with "log4j" in the name).<br />`dependency:log4j=1.2.17` (search for packages dependencies name including "log4j" & version matching 1.2.17).<br />`dependency:log4j<2.0.0` (search for packages dependencies with name including "log4j" & version less than 2.0.0).|
|Repository (`repository`)|`repository:repo-name` (Search for packages within the repository named "repo-name")|
|**Debian:** Component|`deb_component:component-name` (Search for packages by Debian Component)|
|**Docker:** Image Digest|`docker_image_digest:sha256:abcdef` (Search for packages by Docker Image Digest)|
|**Docker:** Layer Digest|`docker_layer_digest:sha256:abcdef` (Search for packages by Docker Layer Digest)|
|**Maven:** GroupID|`maven_group_id:io.cloudsmith` (Search for packages by Maven GroupID)|
|Packages that have violated a policy (`policy_violated`)|`true` (packages that have violated a policy)<br />`false` (packages have not violated a policy)|
|Packages that have violated a vulnerability policy (`vulnerability_policy_violated`)|`true` (packages that have violated a vulnerability policy)<br />`false` (packages have not violated a vulnerability policy)|
|Packages that have violated a license policy (`license_policy_violated`)|`true` (packages that have violated a license policy)<br /> `false` (packages have not violated a license policy)|
|Packages that have violated a deny list policy (`deny_policy_violated`)|`true` (packages that have violated a deny list policy)<br />`false` (packages have not violated a deny list policy)|

**For all queries you can use:**  
`~` for negation.  (Example: `~foo`)

**For string queries you can use:**  
`^`   - to anchor to start of term.  (Example: `^foo`)  
`$` -  to anchor to end of term.  (Example: `foo$`)  
`*`  -  for fuzzy matching.  (Example: `foo*bar`)

**For number or date queries you can use:**  
`>`   -  for values greater than.  (Example: `>foo`)  
`>=` -  for values greater / equal.  (Example: `>=foo`)  
`<`   -  for values less than.  (Example: `<foo`)  
`<=` -  for values less / equal.  (Example: `<=foo`)

Please note, when you use a query like `uploaded: >'1 month ago'`, that becomes `uploaded > dd/mm/yy` (i.e, within the last month).

**For version queries you can use:**  
`>`   -  for versions greater than.  (Example: `>1.2.3.`)  
`>=` -  for versions greater / equal.  (Example: `>=1.2.3`)  
`<`   -  for versions less than.  (Example: `<1.2.3`)  
`<=` -  for versions less / equal.  (Example: `<=1.2.3`)  
`~=` -  for versions greater than or equal to, upto the next incompatible version. (Example: `~=1.2.0`)

<Note variant="note">
  Remember: You can use any combination of `AND`, `OR` and `NOT`. You can use parentheses to group terms if required, as `AND` has a higher precedence than `OR`, and it may change the meaning of queries without it.
</Note>

## A Short Working Example

Suppose that you had the following packages:

- AlphaLib, Version: 1.0
- AlphaLib, Version: 1.1
- AlphaLib, Version: 2.0
- BetaLib: Version: 0.9

To find "AlphaLib" packages that are in the version 1.x series only, your query would be:  
`name:^AlphaLib$ AND version:~=1.0.`

Which would provide the following results:

- AlphaLib, Version: 1.0
- AlphaLib, Version: 1.1

To bring the query down, we added the following parts:

- `name:^AlphaLib$` - Find a package name that is **exactly** "AlphaLib". Without the `^` (starts-with) and `$` (ends-with), the query would be fuzzy, and potentially find packages called "AlphaLib2" or "FreeAlphaLib" too.
- `AND` - We want to search for both the name and version together. Both must match for the results.
- `version:~=1.0` - Find package versions that are at-least 1.0, upto the next incompatible version (2.0).

## Searching Packages via the Cloudsmith web app

At the top of every page is the search box:

<BlockImage src={img_package_search_6_edited} alt=""></BlockImage>

Additional help and examples are available by hovering over the "? Search syntax" at the right side of the search box.

<BlockImage src={img_package_search_3_edited} alt=""></BlockImage>

## Searching Packages via the Cloudsmith API

Please see the Cloudsmith API [interactive sandbox](https://api-prd.cloudsmith.io/v1/#!/packages/packages_list) and the full API [reference](/api/packages/list).


## Searching Packages via the Cloudsmith CLI

To search packages using the Cloudsmith CLI, you use the `cloudsmith list packages` command in combination with the `-q` option: 

```shell
cloudsmith list packages OWNER/REPOSITORY -q "SEARCH_TERMS"
```

**Example**  
To search for all debian packages: 

```shell
cloudsmith list packages cloudsmith/examples -q "format:deb"
```

<BlockImage src={img1aa0913_search_pkgs_cli_format} alt=""></BlockImage>

**Example**  
To search for the latest rpm and composer packages: 

```shell
cloudsmith list packages cloudsmith/examples -q "tag:latest AND (format:rpm OR format:composer)"
```

<BlockImage src={imga2f0d45_search_pkgs_cli_tag_and} alt=""></BlockImage>

**Example**  
To search for all python packages larger than 2KB with more than 50 downloads: 

```shell
cloudsmith list packages cloudsmith/examples -q "format:python AND downloads:>50 AND size:>2048"
```

<BlockImage src={imgac51e3f_search_pkgs_cli_size_dls} alt=""></BlockImage>

# Sorting Packages

---
## Sorting Packages via the Cloudsmith web app

At the top of each repository packages page is the sorting dropdown:


The available sorting options are: 

- Name (A-Z)
- Name (Z-A) 
- Uploaded At (Oldest FIrst) 
- Uploaded At (Newest First)
- Size (Smallest First) 
- Size (Biggest First) 
- Total Downloads (Ascending) 
- Total Downloads (Descending)

Note that currently, the UI only supports sorting by one field at a time.

## Sorting Packages via the Cloudsmith API

Please see the Cloudsmith [API reference](/api/packages/list).

Sorting search results is simple with Cloudsmith. A collection of one or more fields can be supplied in CSV (comma-separated value) format, and the results will be sorted based on the order of the fields provided. 

## Sort Fields

| Sort By                            | Sort Field Example                                                    |
| :--------------------------------- | :-------------------------------------------------------------------- |
| Name (`name`)                      | `-name` (sort by name alphabetically)                                 |
| Format (`format`)                  | `-format` (sort by format alphabetically e.g. alphine, maven, python) |
| Version - String-based (`version`) | `-version` (sort by version, greatest first e.g. 1.2.1, 1.2.0, 1.1.0) |
| Status (`status`)                  |                                                                       |
| Size in Bytes (`size`)             | `-size` (sort by size in bytes, largest package first)                |
| Downloads (`downloads`)            | `downloads` (sort by downloads ascending e.g. 0, 10, 50, 1,000)       |
| Date (`date`)                      | `-date` (sort by uploaded time, most recent first)                    |

**For all fields you can use:**  
`-` to sort by descending order. (Example: `-date`, `-version`)

## A Short Worked Example

Suppose that you had the following packages:

| Name                   | Format | Size | Version | Downloads |
| :--------------------- | :----- | :--- | :------ | :-------- |
| cloudsmith-example-cli | Python | 722  | 1.2.0   | 500       |
| cloudsmith-example-cli | Python | 719  | 1.1.5   | 1000      |
| cloudsmith-java-app    | Maven  | 6910 | 1.0.0   | 2500      |
| cloudsmith-example-pdf | Raw    | 309  | 2.0.0   | 100       |

**To sort packages by size descending, your sort query would be:**

```
-size
```

Which would provide the following results

- cloudsmith-java-app, Size: 6910 bytes
- cloudsmith-example-cli, Size: 722 bytes
- cloudsmith-example-cli, Size: 719 bytes
- cloudsmith-example-pdf, Size: 309 bytes

**To sort packages by format alphabetically, with version descending, your sort query would be:**

```
-format,-version
```

Which would provide the following results:

- cloudsmith-java-app, Format: Maven, Version: 1.0.0
- cloudsmith-example-cli, Format: Python, Version: 1.2.0
- cloudsmith-example-cli, Format: Python, Version: 1.1.5
- cloudsmith-example-pdf, Format: Raw, Version: 1.1.0

## Sorting combined with Searching

Sorting can also be combined with querying. If you wanted to sort by most downloaded Python packages, your query and sort would be:

```
query=format:python&sort=-downloads
```

Which would provide the following results:

- cloudsmith-example-cli, Format: Python, Version: 1.2.0, Downloads: 1000
- cloudsmith-example-cli, Format: Python, Version: 1.2.0, Downloads: 500

