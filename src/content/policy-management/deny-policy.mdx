import { BlockImage } from '@/components'


import deny_create from './images/deny-policy/deny_create.png'
import img_Screenshot_2024_10_18_at_22_01_26 from './images/deny-policy/7e404fe4ae434d837861b82fad3c4df7775eb56d406b516be996572e5130e70b-Screenshot_2024-10-18_at_22.01.26.png'

# Deny Policy
Package deny policy rules let you control which packages can be downloaded from your organization's repositories.

Deny Policies allow users to specify criteria, in the form of a `package_query_string`, to identify packages that cannot be downloaded. By defining these rules, organizations can enforce stricter security measures and maintain tighter control over their software artifacts.

## Supported Package Formats

This feature applies to all formats.

Please note that deny policies don't apply to components inside of a Docker image.

While deny policies can be applied to Docker images by their package name (pull string) or image digest, they won't apply to any internal components. For example, a deny policy with the package query: `format:python`, won't block Docker images containing Python artifacts within the Software Bill of Materials (SBOM).

## Scope

Deny Policies are applied at the organization level.

## View Deny Policies

To view the package deny policies in your organization, go to your organization's "Settings"->"Manage policies"-> "Package Deny Policies" page.

<BlockImage src={img_Screenshot_2024_10_18_at_22_01_26} alt="Package Deny Policies"></BlockImage>

## Create Deny Policies

To create a new deny policy, go to your organization's "Settings" page and select "Package deny policies" from the left side menu. Then click the "Create new policy" button. You are then presented with the "Create package deny policy" form:

<BlockImage src={deny_create} alt=""></BlockImage>

The following fields and options are available:

|||
|:---|:---|
|**Policy Name**|A display name for the deny policy. This name will be visible to users who view a package that violates this policy, as a reason for the violation.|
|**Description**|A description of the Deny Policy.|
|**Package Query**|A search query that you can use to target this policy at a specific repository, package format or package name. See [Searching / Filtering](/artifact-management/search-filter-sort-packages) for more details on the available fields you can filter on.<br/><br/>The query string box (limited to 256 chars in length) to specify a search-query string to match packages against. Matched packages will then be blocked across the org.<br/><br/>TIP: To ensure your search query will block the packages you want to block from download, test your search query first, using the "Search all packages..." box at the top of the Repositories page. Make sure the results of your query are the packages that you intend to block.|
|**Enabled**|You can disable a rule temporarily, without deleting the rule.|

We recommend that you create a package deny policy for each package you want to block, for example, `format:npm AND name:^@react-native-community/cli-server-api$ AND version:<=20.0.0-alpha.2 AND version:>=4.8.0`

## Propagating a Newly Created Deny Policy

**New/Uncached Packages:** Policies are applied instantly to any package proxied directly from an upstream source.

**Existing/Cached Packages:** Cloudsmith automatically runs new policies against all repositories in your organization. This background process may take time depending on your artifact count.

**Tip:** If you need to act on cached artifacts immediately, manually quarantine them using the Cloudsmith web app or API.

You can check the status of a newly created Deny Policy via our [Get a package deny policy](/api/deny-policy/list) REST API call, which will return a `status` of "Pending" while the new policy is being propagated; the `status` will change to "Complete" when the policy is fully implemented across your organization. (You'll need to get the slug_perm identifier for your newly created Deny Policy first - use the [Get a list of all package deny policies](/api/deny-policy/list) REST API call for this.)

Even after a new Deny Policy is fully propagated, a user who has recently downloaded a package may still be able to download it again for a short period of time, due to CDN caching. You can still confirm that your Deny Policy has been successfully applied to a package by confirming the policy violation identifier appears on that package (see below).

## What Gets Blocked

Download requests are blocked for a specific package (or version of a package, if your search string specifies one). This includes the first download of the package, even if the package is proxied through from an upstream.

## Audit Logs

There are also audit logs for whenever users configure (create, update or delete) Deny Policies.

## Unblock a package that violates a policy

To remove a policy violation, you have several options (depending on your user permissions): 

- Delete the Deny Policy.
- Upgrade the package to a version outside of the Deny Policy. 
- Edit the Deny Policy to allow this package using the query string language syntax.
- Temporarily disable the Deny Policy.
