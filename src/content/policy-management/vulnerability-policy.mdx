import { Note, BlockImage } from '@/components'
import img2fe13f1_cross_red from './images/vulnerability-policy/2fe13f1-cross_red.png'
import img006a7b5_tick_green from './images/vulnerability-policy/006a7b5-tick_green.png'

import img0115153_Viewing_policies from './images/vulnerability-policy/0115153-Viewing_policies.png'
import imga85584d_create_policy from './images/vulnerability-policy/a85584d-create_policy.png'
import imge979005_Screenshot_2024_02_01_at_17_09_55 from './images/vulnerability-policy/e979005-Screenshot_2024-02-01_at_17.09.55.png'
import img81b95d6_warning from './images/vulnerability-policy/81b95d6-warning.png'
import img9a9a789_violated_search from './images/vulnerability-policy/9a9a789-violated_search.png'
import img1063680_identifiers from './images/vulnerability-policy/1063680-identifiers.png'
import imga351636_red_flag from './images/vulnerability-policy/a351636-red_flag.png'
import imga40d9a3_quarantine_icon from './images/vulnerability-policy/a40d9a3-quarantine_icon.png'
import imge92a797_security_error from './images/vulnerability-policy/e92a797-security_error.png'
import imge60d98f_notification from './images/vulnerability-policy/e60d98f-notification.png'
import img93248c2_package_logs from './images/vulnerability-policy/93248c2-package_logs.png'

# Vulnerability Policy
Vulnerability Policies enable you to set the acceptable severity threshold for vulnerabilities within your organization. You can create several policies at different levels and determine the actions to take when a package returns a vulnerability level that meets or exceeds a specified threshold.

This feature is useful when you want to either flag or automatically quarantine a package based on the level of vulnerability detected.

## Supported Package formats

Vulnerability scanning and vulnerability policies are supported for the following package formats:

|Format|Vulnerability Scanning Support|
|:---|:---|
|[Alpine](/formats/alpine-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Cargo](/formats/cargo-registry)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Conan](/formats/conan-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Cocoapods](/formats/cocoapods-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Composer](/formats/composer-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Conan](/formats/conan-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Conda](/formats/conda-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[CRAN](/formats/cran-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Dart](/formats/dart-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Debian](/formats/debian-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Docker](/formats/docker-registry)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Go](/formats/go-registry)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Helm](/formats/helm-chart-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Hex](/formats/hex-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[LuaRocks](/formats/luarocks-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Maven](/formats/maven-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[npm](/formats/npm-registry)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[NuGet](/formats/nuget-feed)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[P2](/formats/p2-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Python](/formats/python-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[RPM](/formats/redhat-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Ruby](/formats/ruby-repository) (Beta)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Swift](/formats/swift-registry)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Terraform](/formats/terraform-modules-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Vagrant](/formats/vagrant-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|

## View Vulnerability Policies

To manage vulnerability policies in your organization, go to your organization's "Settings" page and select "Vulnerability Policy" from the left-hand menu.

<Note variant="warning">
  Deactivating a policy is not currently supported, so any policy created will remain active until deleted.
</Note>

<BlockImage src={img0115153_Viewing_policies} alt="View Vulnerability Policies"></BlockImage>

## Create Vulnerability Policy

To create a new vulnerability policy, click "Create Vulnerability Policy."

<BlockImage src={imga85584d_create_policy} alt="Create Vulnerability Policy Button"></BlockImage>

You are then presented with the “Create Vulnerability Policy” form:

<BlockImage src={imge979005_Screenshot_2024_02_01_at_17_09_55} alt="Create Vulnerability Policy Form"></BlockImage>

Here you can define the following:

|Field|Description|
|:---|:---|
|**Policy Name**|A display name for the Vulnerability Policy.|
|**Description**|A description of the Vulnerability Policy.|
|**Package Query**|A search query that you can use to target this policy at a specific repository, package format or package name. See [Searching / Filtering](/artifact-management/search-packages) for more details on the available fields you can filter on|
|**Select Vulnerability Threshold**|The vulnerability threshold for the policy.<br /><br />Following a package security scan, if a vulnerability matching or exceeding this value is returned, the package will be in violation of the policy.  <br /><br />Vulnerability thresholds are based on the following CVSS v3.1 severity ratings:  - Critical (9.0 - 10.0)  <br /><br />- High (7.0 - 8.9)  <br /><br />- Medium (4.0 - 6.9)  <br /><br />- Low (0.1 - 3.9)|<br /><br />
|**Quarantine packages which violate policy**|If set to "Yes", any package that has a vulnerability equal to or higher than the threshold will be flagged and automatically quarantined.<br /><br />If set to "No", packages that violate the policy will only be flagged, but they will not be automatically quarantined.|
|**Allow Unknown severity level**|Vulnerabilities may have no CVSS score or severity rating, in which case the severity level is categorized as "Unknown".<br /><br />This setting determines whether or not the Vulnerability Policy should be applied to packages which have vulnerabilities in that category.<br /><br />If set to "Yes", a package with vulnerabilities of an unknown severity level will not be considered to be in violation of the policy. <br /><br />If set to "No", a package with vulnerabilities of an unknown severity level will be considered to be in violation of the policy and the configured policy actions will be taken.|

Once saved, the policy is enabled across your organsization, and the vulnerability policy check is performed on a package every time it undergoes a security scan. 

<Note variant="note">
  Packages are automatically security scanned on upload and subsequent security scans can be triggered manually via the Web UI, and the Cloudsmith API. See [\[Security Scanning\]](/policy-management/security-scanning) for further details on our security scanning feature.
</Note>

## Policy Violation Notification

When a package violates a vulnerability policy a warning is displayed within the UI:

<BlockImage src={img81b95d6_warning} alt="Vulnerability Violation Warning"></BlockImage>

Clicking the link within this warning, displays a custom search page, displaying all packages with policy violations:

<BlockImage src={img9a9a789_violated_search} alt="Policy Violation List"></BlockImage>

<Note variant="note">
  You can view this violation list at any time using our package search [(link)](/artifact-management/search-packages#searching-packages-via-the-website-ui) feature and setting the filter to `policy_violated:true` for all policy violations, or `vulnerability_policy_violated:true` to only display vulnerability policy violations.
</Note>

## Policy Violation Identifiers

Within a repository, packages with policy violations are identified with the Policy Violation and Quarantined icons. 

<BlockImage src={img1063680_identifiers} alt="Policy Violation Indicators"></BlockImage>

||||
|:---|:---|:---|
|<BlockImage src={imga351636_red_flag} alt=""></BlockImage>|Policy Violation|This package is in violation of a vulnerability policy. Click on the package to view more details.|
|<BlockImage src={imga40d9a3_quarantine_icon} alt=""></BlockImage>|Quarantined|This package has been quarantined, downloads will be blocked until the package is released from quarantine.<br /><br />Reason given: the package was quarantined as a result of a policy violation|
|<BlockImage src={imge92a797_security_error} alt=""></BlockImage>|Security Vulnerability Detected|The security scan has detected vulnerabilities within this package.|

Clicking on the package name displays the Package view page, which provides details on the policy that has been violated. 

<BlockImage src={imge60d98f_notification} alt=""></BlockImage>

## Package Logs

Logs of policy violations and quarantining actions are also displayed within the Package Logs page: 

<Note variant="note">
  Hover over the “policy violation” text to display additional details on the policy and vulnerability violation.
</Note>

<BlockImage src={img93248c2_package_logs} alt=""></BlockImage>

## Restore a package that violates a policy

To remove a policy violation, you have three options: 

- Upgrade the package to a version that has resolved the security vulnerability. 
- Edit the vulnerability policy to lower the threshold below the violated level. A [manual rescan](/policy-management/security-scanning#additional-security-scans-via-the-cloudsmith-web-ui) of the package is required to remove the policy violation flag and the package must also be manually [released from quarantine](/artifact-management/package-quarantine#release-from-quarantine).
- Use the restore functionality to remove the package from quarantine. Keep in mind, however, that subsequent security scans may return the package to quarantine. See [Release from quarantine](/artifact-management/package-quarantine#release-from-quarantine) for instructions on restoring a package from quarantine.
