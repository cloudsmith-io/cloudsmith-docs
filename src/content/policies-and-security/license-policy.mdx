import { Note, BlockImage } from '@/components'
import img006a7b5_tick_green from './images/license-policy/006a7b5-tick_green.png'
import img2fe13f1_cross_red from './images/license-policy/2fe13f1-cross_red.png'
import img_settings_manage_license_policies from './images/license-policy/c003d4c5f13c07f716c7eeb9a58ff08cd09e12983a40ed4840e8a4662705680b-settings-manage-license-policies.png'
import img_create_license from './images/license-policy/e5f0379d7b25a175eca1fc975a05e040995a96ec13f4f4e97a9b558f8e4a6bff-create-license.png'
import img_create_license_policy_form from './images/license-policy/0fe4ba308b83f6772b9f2a5872de71ce98c5be053ef31e85e8ba5408af891810-create-license-policy-form.png'
import img_violation from './images/license-policy/cd0067c990f994778f786fec0722a9762c2d763676e9a96de7dea493e0f071f5-violation.png'
import img_search_policy_violations from './images/license-policy/e11a1a83691e4515c5e9a687c1d658e3e1d93c2d78907ddb94ebd7bffa436ee2-search-policy-violations.png'
import img_icons from './images/license-policy/d0f4b2db2730243492ebc82e00223d3b40bea851dff71e286229de93da55ca3c-icons.png'
import imga351636_red_flag from './images/license-policy/a351636-red_flag.png'
import imga40d9a3_quarantine_icon from './images/license-policy/a40d9a3-quarantine_icon.png'
import img_view_policy_violation from './images/license-policy/37b3010d2d23eafca8f93e5246acbded37595d3dc23f45b2552298ec003b7485-view-policy-violation.png'
import img_edit_license_policy from './images/license-policy/11290e4d631f45d7a3a4ea12a312a371c0d66e2dca7d2c0a9780dd00efa57495-edit-license-policy.png'

# License Policy

License Policies allow you to define which package licenses are allowed within your organization. You can specify one or more licenses to exclude and an action to perform when a specified license is detected. 

This is useful when you need to flag or optionally automatically quarantine a package based on the associated license. 

## Supported Package formats

Cloudsmith will automatically match licenses for the following package formats:

|Format|<div class="cs-center">License Support </div>|
|:---|:---|
|[Alpine](/package-formats/alpine-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Cargo](/package-formats/cargo-registry)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Cocoapods](/package-formats/cocoapods-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Composer](/package-formats/composer-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Conan](/package-formats/conan-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Conda](/package-formats/conda-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[CRAN](/package-formats/cran-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Dart](/package-formats/dart-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Debian](/package-formats/debian-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Docker](/package-formats/docker-registry)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Go](/package-formats/go-registry)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Helm](/package-formats/helm-chart-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Hex](/package-formats/hex-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[LuaRocks](/package-formats/luarocks-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Maven](/package-formats/maven-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[npm](/package-formats/npm-registry)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[NuGet](/package-formats/nuget-feed)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Python](/package-formats/python-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[RPM](/package-formats/redhat-repository)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Ruby](/package-formats/ruby-repository) (Beta)|<BlockImage src={img006a7b5_tick_green} alt=""></BlockImage>|
|[Terraform](/package-formats/terraform-modules-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|
|[Vagrant](/package-formats/vagrant-repository)|<BlockImage src={img2fe13f1_cross_red} alt=""></BlockImage>|

## View License Policies

To manage the license policies in your workspace, go to your workspace's Settings page and select Manage Policies >> License Policies from the left-hand menu.

<Note variant="warning">
  Deactivating a policy is not supported at this time, resulting in any policy created being active until deleted.
</Note>

<BlockImage src={img_settings_manage_license_policies} alt=""></BlockImage>

## Create License Policy

To add a new license to the deny list, click “Create License Policy”.

<BlockImage src={img_create_license} alt="Create License Policy Button"></BlockImage>

You are then presented with the “Create a License Policy” form:

<BlockImage src={img_create_license_policy_form} alt=""></BlockImage>

Here you can define the following:

|||
|:---|:---|
|Name|A display name for the License Policy.|
|Description|A description of the License Policy.|
|Allow unknown or absent licenses|Set to “Yes” to ignore packages with missing or unknown licenses. Set to “No” to flag and quarantine packages with a missing or unknown license.<br/><br/>Note: SPDX License List is used as the license source. If a package has a license that is not listed in the [SPDX License List](https://spdx.org/licenses/), this will be treated as an unknown license.|
|Quarantine on violation|If set to "Yes", any package that violates this license policy is flagged and automatically quarantined. <br/><br/>If set to "No", packages that violate this license policy are flagged, but not automatically quarantined.|
|Select licenses to deny|Select the licenses to be denied as part of this policy. The licenses listed in this table are sourced from the [SPDX License List](https://spdx.org/licenses/).|

{/* [block:parameters]
{
  "data": {
    "h-0": "",
    "h-1": "",
    "0-0": "Name",
    "0-1": "A display name for the License Policy.",
    "1-0": "Description",
    "1-1": "A description of the License Policy.",
    "2-0": "Allow unknown or absent licenses",
    "2-1": "Set to “Yes” to ignore packages with missing or unknown licenses. Set to “No” to flag and quarantine packages with a missing or unknown license.  \n  \nNote: SPDX License List is used as the license source. If a package has a license that is not listed in the [SPDX License List](https://spdx.org/licenses/), this will be treated as an unknown license.",
    "3-0": "Quarantine on violation",
    "3-1": "If set to \"Yes\", any package that violates this license policy is flagged and automatically quarantined.  \n  \nIf set to \"No\", packages that violate this license policy are flagged, but not automatically quarantined.",
    "4-0": "Select licenses to deny",
    "4-1": "Select the licenses to be denied as part of this policy. The licenses listed in this table are sourced from the [SPDX License List](https://spdx.org/licenses/)."
  },
  "cols": 2,
  "rows": 5,
  "align": [
    "left",
    "left"
  ]
}
[/block] */}


Once saved, the policy is enabled across your workspace and the policy compliance check will be performed automatically during the package synchronisation process. This process occurs when a package is uploaded, moved, copied, or cached (such as in upstream caching).

You can also manually trigger a synchronisation of a package using the resync functionality. See [Package Resynchronization](/artifacts/resync-a-package) for instructions on how to do this. 

## Policy Violations

License policy violations can be viewed on the workspace and repository compliance dashboards. By selecting License Policy Violations from the overview, the table will filter to show all license policy violations across the workspace or repository. 

<BlockImage src={img_violation} alt="violated policy warning"></BlockImage>

You can also search for policy violations using `policy_violated:true`. 

<BlockImage src={img_search_policy_violations} alt="violated policy search"></BlockImage>

<Note variant="note">
  You can view this violation list at any time using our package search [(link)](https://help.cloudsmith.io/docs/search-packages#searching-packages-via-the-website-ui) feature and setting the filter to `policy_violated:true` for all policy violations, or `license_policy_violated:true` to only return license policy violations.
</Note>

## Policy Violation Identifiers

Within a repository, packages with policy violations are identified with the Policy Violation and Vulnerabilities icons. 

<BlockImage src={img_icons} alt="Policy Violation Indicators"></BlockImage>

||||
|:---|:---|:---|
|<BlockImage src={imga351636_red_flag} alt=""></BlockImage>|Policy Violation|This package is in violation of policy. Click on the package to view more details.|
|<BlockImage src={imga40d9a3_quarantine_icon} alt=""></BlockImage>|Quarantined|This package has been quarantined, downloads will be blocked until the package is released from quarantine.<br/><br/>Reason given: the package was quarantined as a result of a policy violation|

Clicking on the package name displays the Package overview, which provides details on the policy violations for the package. 


<BlockImage src={img_view_policy_violation} alt="package page warning"></BlockImage>

By selecting License Policy Violation from the summary, you can view a list of all license policies the package violates and view and modify the policies from there.

<BlockImage src={img_edit_license_policy} alt=""></BlockImage>

## Package Logs

Logs of policy violations and quarantining actions are also displayed within the Package Logs page. 

<Note variant="note">
  Hover over the “policy violation” text to display additional details on the policy and license violation.
</Note>

## Restore a package that violates a policy

It's important to note that packages cannot be restored from quarantine if they are still in violation of an existing policy which has **Quarantine on violation** set to "Yes". 

To remove a package from quarantine, you have four options: 

- Change the package license to an allowed license via the [license compliance](/policies-and-security/license-compliance#edit-a-license) section of the package's repository.
- Apply a manual license override of "ignored" or "purchased" via the [license compliance](/policies-and-security/license-compliance#edit-a-license) section of the package's repository.
- Edit the license policy to remove the license from the deny list.
- Edit the license policy to set **Quarantine on violation** to "No".

If you change the package license, the package will be resynchronized and automatically undergo the policy check again. If the new license is not on the deny list, the package will no longer be marked as a policy violation and can be manually removed from quarantine.

If you update the policy to remove the license from the deny list or set **Quarantine on violation** set to "No", the package can be manually removed from quarantine.

See [Package Quarantine](/artifacts/package-quarantine#release-from-quarantine) for instructions on restoring a package from quarantine.
