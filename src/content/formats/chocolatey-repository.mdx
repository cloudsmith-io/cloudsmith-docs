import { Note } from '@/components';
export const parentTitle = 'Supported Formats';

# Chocolatey Repository

Cloudsmith provides public & private repositories for Chocolatey

Chocolatey is a package manager for Windows (like apt-get but for Windows). Chocolatey is built on top of NuGet and PowerShell (the automation language for Windows). You can package and install anything on Windows using Chocolatey - if it can be automated, Chocolatey and PowerShell can install, upgrade, and uninstall it.

For more information on Chocolatey, please see:

- [Chocolatey](https://chocolatey.org/): The official website for Chocolatey
- [Chocolatey Documentation](https://docs.chocolatey.org/en-us/): The official docs for Chocolatey
- [Create a Chocolatey Package](https://docs.chocolatey.org/en-us/create/create-packages)
- [Install Chocolatey](https://docs.chocolatey.org/en-us/choco/setup)
- [Build/Test/Push a Chocolatey Package](https://docs.chocolatey.org/en-us/create/create-packages#build-your-package)

Chocolatey packages are known as nupkg files, which is a compiled NuSpec or a fancy zip file that knows about package metadata (including dependencies and versioning). These packages are an enhanced NuGet package, they have additional metadata that is specific to Chocolatey. Chocolatey is also compatible with vanilla NuGet packages. A Chocolatey package can contain embedded software and/or automation scripts. For more information on how Chocolatey works see: [How Does Chocolatey Work](https://docs.chocolatey.org/en-us/getting-started#how-does-chocolatey-work)

<Note variant="note" headline="Contextual Documentation">
  The examples in this document are generic. Cloudsmith provides contextual setup instructions within each repository, complete with copy and paste snippets (with your namespace/repo/rsa-key pre-configured).
</Note>

In the following examples: 

| Identifier      | Description                                                                               |
| :-------------- | :---------------------------------------------------------------------------------------- |
| OWNER           | Your Cloudsmith account name or organization name (namespace)                             |
| REPOSITORY      | Your Cloudsmith Repository name (also called "slug")                                      |
| TOKEN           | Your Cloudsmith Entitlement Token (see [Entitlements](/software-distribution/entitlement-tokens) for more details) |
| USERNAME        | Your Cloudsmith username                                                                  |
| PASSWORD        | Your Cloudsmith password                                                                  |
| API-KEY         | Your Cloudsmith API Key                                                                   |
| PACKAGE_NAME    | The name of your package                                                                  |
| PACKAGE_VERSION | The version number of your package                                                        |

## Prerequisites

[Prerequisites](https://docs.chocolatey.org/en-us/create/create-packages-quick-start#prerequisites) to creating your Choco package.

Documentation on the Chocolatey CLI including a full list of commands can be found  [here](https://docs.chocolatey.org/en-us/choco/).

The Chocolatey Windows package manager uses the same infrastructure as NuGet. Therefore packages are based on the same principles. One of those is a package description (specification) in xml format, known as the [Nuspec file](https://docs.chocolatey.org/en-us/create/create-packages#nuspec). 

The following are the main elements of a Chocolatey package. Only the Nuspec is required (#1 below).

1. Nuspec
2. `chocolateyInstall.ps1` is triggered on install and upgrade.
3. Any application files to include (it is highly suggested that you are the author in this case or you have the right to distribute files). EXE files in the package/downloaded to package folder from `chocolateyInstall.ps1` will get a link to the command line.
4. `chocolateyUninstall.ps1`, for uninstalling your package. 
5. `chocolateyBeforeModify.ps1` for upgrades.

## Upload a  package

The endpoint for the chocolatey packages API is:

```
https://nuget.cloudsmith.io/OWNER/REPOSITORY/v2
```

### Create a Chocolatey Package using the Chocolatey CLI

Open a command line in the directory where the nuspec is and type 

```shell
choco pack
```

This generates a nupkg (`.nupkg`) file like `your-package-1.2.3.nupkg` that you can upload.

### Test your Package

To test the package you just built, open a command line shell and navigate to the directory where the \*.nupkg file is located. Then type:

```shell
choco install packageName -dv -s .
```

### Upload a package via native Chocolatey tooling

You can upload your package using the Chocolatey CLI.

You can publish a nupkg file that you've generated from your project, using [NuGet](https://www.nuget.org/downloads).

Then you can publish your package using:

```shell
choco push PACKAGE_NAME-PACKAGE_VERSION.nupkg -Source https://nuget.cloudsmith.io/OWNER/REPOSITORY/v2 -ApiKey API-KEY
```

<Note variant="note" headline="Note">
As of Chocolatey V 2.0.0, Chocolatey can use NuGet V3 feeds as sources.
</Note>

### Upload via the Cloudsmith CLI

For full details of how to install and setup the Cloudsmith CLI, see [Command-Line Interface](/developer-tools/cli) .

The command to upload a Chocolatey package via the Cloudsmith CLI is:

```shell
cloudsmith push nuget OWNER/REPOSITORY PACKAGE_NAME-PACKAGE_VERSION.nupkg
```

Example:

```shell
cloudsmith push nuget your-account/your-repo your-package-1.2.3.nupkg
```

### Upload via Cloudsmith web app

Please see [Upload a Package](/artifact-management/package-upload) for details of how to upload via the Cloudsmith web app. 

## Download / Install a Package

As a shortcut, you can set up the source (upstream) ahead of time, using `choco source`:

```shell Entitlement Token
choco source add -n example-repo -s https://nuget.cloudsmith.io/OWNER/REPOSITORY/v2 -u "token" -p "TOKEN"
```
```shell Username & Password
choco source add -n example-repo -s https://nuget.cloudsmith.io/OWNER/REPOSITORY/v2 -u "USERNAME" -p "PASSWORD"
```
```shell Username & API-Key
choco sources add -n example-repo -s https://nuget.cloudsmith.io/OWNER/REPOSITORY/v2 -u "USERNAME" -p "API-KEY"
```

<Note variant="warning" headline="warning">
Entitlement Tokens, User Credentials and API-Keys should be treated as secrets and you should ensure that you do not commit them in configurations files along with source code, or expose them in any logs.
</Note>

### Install a Package

Then to install a package, you use `choco install`

```shell
choco install PACKAGE_NAME -Source example-repo 
```

## Nuget and Cloudsmith CLI

See, [NuGet Feed](/formats/nuget-feed), for how to create chocolatey packages using Nuget or the cloudsmith CLI.
