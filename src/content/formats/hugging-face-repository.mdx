# Hugging Face Repository

Hugging Face is an open-source platform and ecosystem for building, sharing, and deploying machine learning models, especially in the field of natural language processing (NLP) and generative AI.

## Repository Types

The Hugging Face Hub has three different types of repositories:

1. Model Repositories: This are used to store and distribute **machine learning models**, including weights, configs, tokenizer files, and model cards. They are commonly used with the [`transformers` library](https://huggingface.co/docs/transformers/models).
2. Dataset Repositories: These are used to store **datasets**, scripts for loading them, and metadata. They are commonly used with the [`datasets` library](https://huggingface.co/docs/datasets/en/stream).
3. Space Repositories: These are used to host interactive apps, usually built with Gradio or Streamlit. They are like web demos for models or data.

Models and Datasets are supported and identified in the `<hf_repo_type>` field as `models` and `datasets`. In addition to the libraries mentioned above, Cloudsmith supports the main [`huggingface_hub`](https://huggingface.co/docs/huggingface_hub/index) python library to work with `models` and `datasets`.

For more information on Hugging Face, see:

- **[Hugging Face](https://huggingface.co/)**: The official website for the company and its ecosystem.
- **[Hugging Face Hub](https://huggingface.co/)**: The official public platform for models, datasets, and demo apps.

## Differences from Hugging Face

Here you can see a general overview of the main naming equivalences:

| Hugging Face Term | Cloudsmith Term |
| :---------------- | :-------------- |
| Repository        | Package         |
| Commit            | Version         |
| Tag               | Package Tag     |

Keet reading to learn more about them.

### Repository as a Package

In Cloudsmith, a Hugging Face repository is treated as a single package. This creates a simple and direct one-to-one relationship, so a package name in your Cloudsmith repository will be identical to the Hugging Face repository name, including its namespace. For example, a Hugging Face repository named `workspace/sentiment-analyzer` will correspond to a Cloudsmith package named `workspace/sentiment-analyzer`.

### Commits and versions

In the Hugging Face ecosystem, a commit represents a complete snapshot of a repository at a specific point in time. This concept is fundamental to achieving reproducibility in your AI/ML builds, as each commit provides a precise, traceable record of your model, dataset, or space.

To align with this structure, Cloudsmith maps Hugging Face repositories and their commits directly to packages and versions within Cloudsmith:

- Hugging Face Repository as a Package: the name of a Hugging Face repository (e.g., org-name/model-name) corresponds directly to the package name in Cloudsmith. You don't need to create a separate object to represent the repository itself, or create multiple repositories within Cloudsmith.

- Commit as a package version: each unique commit pushed to the Hugging Face repository becomes a new, distinct version of that package in Cloudsmith. The version string is typically the commit hash (e.g., e243b1b).

This approach creates an intuitive mapping: for example, if you have a Hugging Face repository named my-org/my-awesome-model, it will exist in Cloudsmith as a single package with that name. When you push a new commit with the hash a1b2c3d, a new version, a1b2c3d, of the my-org/my-awesome-model package is created, containing all the files from that specific snapshot. This ensures that every change is versioned and fully reproducible, and guarantees a similar workflow within Cloudsmith to the ones you are used to.

### Tags

In Hugging Face, a tag is a user-friendly alias to a specific commit (version). Instead of using a long commit hash like e243b1b, you can use a human-readable tag like `v1.0` or `latest` to refer to that same snapshot. At Cloudsmith:

- 1:1 mapping: Hugging Face tags are mapped directly to package tags.
- Uniqueness: just as tags are unique within a Hugging Face repository, Cloudsmith tags are unique per package
- Flexibility: unlimited number of tags pointing to a single version (commit). For example, the tags latest, v2.1, and stable can all point to the same commit hash.

This mapping allows you to request a package version using a simple tag, similarly to what you can do with Docker. For instance, you can fetch the files associated with the main branch by requesting the package version tagged as main, and Cloudsmith will resolve it to the correct underlying commit automatically.

TODO: any functionality differences we should flag?

---

In the following examples:

| Identifier | Description                                                        |
| :--------- | :---------------------------------------------------------------   |
| `WORKSPACE`  | Your Cloudsmith workspace name.                                  |
| `REGISTRY`   | Your Cloudsmith Repository name (also called "slug").            |
| `TOKEN`      | Your Cloudsmith API Token                                        |
| `API-KEY`    | Your Cloudsmith API Key.                                         |
| `repo_id` | The name of your HF artifact.                                       |
| `repo_type` | The type of artifact: `model` or `dataset`.                       |
| `TAG`        | A tag for your HF artifact.                                      |

## Uploading Packages

You can easily upload your models and datasets to Cloudsmith using the tools you already know. Cloudsmith supports uploads via the `huggingface_hub` Python library, which is the underlying engine for popular libraries like `transformers` and `datasets`.

Before starting, set the `HF_ENDPOINT` and `HF_TOKEN` environment variables with your Cloudsmith endpoint and API Token.

### Using `huggingface_hub`

This is the most direct method. You can upload any folder containing your model or dataset files using the `upload_folder` function.

```python
from huggingface_hub import HfApi

HF_TOKEN="cs_API_TOKEN"
HF_ENDPOINT="https://huggingface.cloudsmith.io/WORKSPACE/REPOSITORY/"

api = HfApi(endpoint=HF_ENDPOINT, token=HF_TOKEN)
api.upload_folder(
    folder_path="./path/to/your/model_files/",
    repo_id="WORKSPACE/REPOSITORY",
    repo_type="model",
    commit_message="Initial upload via CS",
    revision="main"
)
```

### Using the `transformers` Library

If you're working with a model from the `transformers` library, you can use the built-in `push_to_hub` method. Just make sure you've set the endpoint to point to Cloudsmith.

```python
from transformers import AutoModel

# Load or train your model
model = AutoModel.from_pretrained("bert-base-uncased")

# The name of your package in Cloudsmith
repo_id = "my-bert-model"

# Push the model to your Cloudsmith repository
model.push_to_hub(repo_id)

print(f"Successfully pushed {repo_id} to Cloudsmith!")
```


### Using the `datasets` Library

Similarly, you can upload a dataset using the `push_to_hub` method directly from a `datasets` object.

```python
from datasets import load_dataset

# Load or create your dataset
dataset = load_dataset("rotten_tomatoes", split="train")

# The name of your package in Cloudsmith
dataset_name = "rotten-tomatoes-train"

# Push the dataset to your Cloudsmith repository
dataset.push_to_hub(dataset_name)

print(f"Successfully pushed {dataset_name} to Cloudsmith!")
```


## Downloading Packages

Cloudsmith supports the `huggingface_hub` Python library to upload packages using its `snapshot_download` function. It also supports `transformers` and `datasets` downloads.

Before starting, set the `HF_ENDPOINT` and `HF_TOKEN` environment variables with your Cloudsmith endpoint and API Token.


### Using `huggingface_hub`

This is the most direct way to download all the files for a specific package version (commit) from your Cloudsmith repository.

```python

from huggingface_hub import HfApi

HF_TOKEN="cs_API_TOKEN"
HF_ENDPOINT="https://huggingface.cloudsmith.io/WORKSPACE/REPOSITORY/"

api = HfApi(endpoint=HF_ENDPOINT, token=HF_TOKEN)
local_dir = api.snapshot_download(
    repo_id="WORKSPACE/REPOSITORY", repo_type="model", revision="main"
)
```


### Using the `transformers` Library

Loading a pre-trained model from your Cloudsmith repository is seamless. The `from_pretrained` method will automatically handle the download once the endpoint is configured.

```python
import os
from transformers import AutoModel

# Set your Cloudsmith repository endpoint and token
os.environ["HF_ENDPOINT"] = "https://huggingface.cloudsmith.io/my-org/my-repo/"
os.environ["HF_TOKEN"] = "cs_..." # Your Cloudsmith API Key

# The name of the package (model) to load from Cloudsmith
repo_id = "my-bert-model"

# Load the model, which triggers a download from Cloudsmith
model = AutoModel.from_pretrained(repo_id)

print(f"Successfully loaded model {repo_id} from Cloudsmith!")
```


### Using the `datasets` Library

Similarly, you can load any dataset stored in Cloudsmith using the standard `load_dataset` function.

```python
import os
from datasets import load_dataset

# Set your Cloudsmith repository endpoint and token
os.environ["HF_ENDPOINT"] = "https://huggingface.cloudsmith.io/my-org/my-repo/"
os.environ["HF_TOKEN"] = "cs_..." # Your Cloudsmith API Key

# The name of the package (dataset) to load
dataset_name = "rotten-tomatoes-train"

# Load the dataset from your Cloudsmith repository
dataset = load_dataset(dataset_name)

print(f"Successfully loaded dataset {dataset_name} from Cloudsmith!")
```

## Security Scanning

<Tag variant="dark-gray" theme="legacy">Not Supported</Tag>

## Current Limitations

Hugging Face Spaces are not supported.

## Upstream Proxying / Caching

<Tag variant="dark-green" theme="legacy">Supported</Tag>

You can configure your Cloudsmith repository to act as a proxy for the public **Hugging Face Hub**. This allows you to cache models and datasets from the public Hub into your private Cloudsmith repository for faster, more reliable access, at the same time as you manage your own private models and datasets.

## Key Signing Support

<Tag variant="dark-green" theme="legacy">Not Supported</Tag>
