import { BlockImage, Note } from '@/components'

import malware from './images/malware_block.png'
import malware_fail_sync from './images/malware_fail_sync.png';

# Malware scanning

Defense in depth is a strategy that employs multiple layers of security controls to protect an organization's assets. Cloudsmith offers different barriers to help you safeguard against artifacts that pose risks to your organization. One of these layers is a malware scanner.

In the context of artifact management, malware scanning is the process of inspecting software packages, container images, and dependencies for malicious code before they are stored in a repository or used in a build. It's a critical security step to protect the software supply chain.

<Note>ðŸ“˜ Malware scanning via ClamAV is included in all Cloudsmith plans.</Note>

## How it works

Cloudsmith uses a signature-based detection engine at its core, which matches findings in your artifacts against a library of digital fingerprints for known malicious software. Each piece of malware has unique characteristics, or "signatures", that can be used to identify it. These signatures can be a string of bytes from the malware's code, a cryptographic hash (a unique fixed-size string of characters) of a malicious file, or other distinct patterns.

Before any artifact is synchronized, its files are scanned (the signature-based detection engine compares its components against this extensive database of known malware signatures), and the package won't be synced if a match is found. In this case, the file would be flagged as malicious. For example, trying to upload a malicious file from a terminal will result in the following output:

<BlockImage src={malware} alt=""></BlockImage>

We can see that the package was not synchronized, and its status is `FAILED`. We can try to resynchronize the asset again, but it will fail the scan again. This package won't be available for download, copying, moving, or any other action. Hence, the risk is eliminated.

<BlockImage src={malware_fail_sync} alt=""></BlockImage>

<Note variant="note" headline="Sample malware: eicar">
If you want to reproduce the next steps, instead of using `xmrig`, you can download an [innocuous sample malware file](https://www.eicar.org/download/eicar-com-2/?wpdmdl=8842&refresh=68497c10a78741749646352). This file contains a known signature in the malware database, and you can use it to test any malware scanner.
</Note>

First, upload the file using the Cloudsmith CLI with:

```bash
cloudsmith push raw WORKSPACE/REPOSITORY ./eicar.com.txt
```

Now, we can get more information and retrieve package metadata with the API. First, update the `envvars` with your own data, and then get the package identifier (`slug_perm`):

```bash
API_TOKEN=
WORKSPACE=
REPO=
curl -s -X GET \
  'https://api.cloudsmith.io/v1/packages/WORKSPACE/REPO/' \
  -H 'accept: application/json' \
  -H 'X-Api-Key: API_TOKEN' \
   | jq '.[] | "\(.name)  \(.slug_perm)"' 
   | grep eicar
  ```

Using the `package id` (in this case `IfwsHhsYbTaB` ), we can retrieve the status reason and more information from its metadata fields:

```bash
curl -s -X 'GET' \
  'https://api.cloudsmith.io/v1/packages/WORKSPACE/REPOSITORY/IfwsHhsYbTaB/' \
  -H 'accept: application/json' \
  -H 'X-Api-Key: API_TOKEN' \
   | jq '{ status: .status_reason, malware: .extended_metadata.Malware }'
```

```
{
  "status": "FAILED",
  "malware": "Potentially malicious content detected: Win.Test.EICAR_HDB-1 - See the package Metadata section for more information. Otherwise, please contact us."
}
```

Here we can see that the initial scan found a malicious package and automatically stopped the sync process.

## Supported Formats

| Package Format | Supported Archive Types |
|---|---|
| Python | zip (.whl), tar.gz |
| Java/Maven | zip (.jar) |
| NuGet | zip (.nupkg) |
| npm | tar.gz (.tgz) |
| Helm | tar.gz (.tgz) |
| Conan | zip, tar.gz |
| Raw files | Scanned based on [file type](https://docs.clamav.net/appendix/FileTypes.html) |

## Conclusions

Scanning every artifact for malware - along with other Cloudsmith security features - is one of the key building blocks to ensure that your applications are safe, protecting your infrastructure and end-users from compromised code. To learn more on other features available in Cloudsmith that help safeguard your organization against malware, see [Malicious Packages](/supply-chain-security/epm/malicious-packages).